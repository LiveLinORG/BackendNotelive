<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>NoteLive</title>
</head>
<body>
    <div class="container">
        <div class="homepage">
            <div class="card" onclick="crearSala()">
                <div class="card-icon">
                    <img src="plus_icon.png" alt="Crear Sala">
                </div>
                <h2>Crear Sala</h2>
                <p>Crea una nueva sala para comenzar tu experiencia en NoteLive.</p>
                <button>Crear Sala</button>
            </div>
            <div class="card" onclick="unirseASala()">
                <div class="card-icon">
                    <img src="door_icon.png" alt="Unirse a Sala">
                </div>
                <h2>Unirse a Sala</h2>
                <p>Únete a una sala existente introduciendo el código correspondiente.</p>
                <button>Unirse a Sala</button>
            </div>
        </div>
    </div>

    <div id="sala" style="display: none;">
        <div class="columns">
            <div class="chat-column">
                <form id="formulario" style="display: none;">
                    <input type="text" id="pregunta" placeholder="Escribe tu pregunta...">
                    <button type="submit">Enviar</button>
                </form>

                <div id="preguntas" style="display: none;">
                    <!-- Aquí irán las preguntas -->
                </div>

                <div id="codigo"></div>
            </div>
            <div class="central-column">
                <!-- Aquí irá la columna central -->
            </div>
            <div class="questions-column" style="display: none;">
                <!-- Aquí irán las preguntas -->
            </div>
        </div>
    </div>

    <footer id="footer"></footer>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let salaActual = null;

        function crearSala() {
            socket.emit('crear_sala');
        }

        function unirseASala() {
            const codigo = prompt("Introduce el código de la sala:");
            if (codigo) {
                socket.emit('unirse_sala', codigo);
            }
        }

        const formulario = document.getElementById('formulario');
        const inputPregunta = document.getElementById('pregunta');
        const listaPreguntas = document.getElementById('preguntas');

        formulario.addEventListener('submit', (event) => {
            event.preventDefault();
            const pregunta = inputPregunta.value.trim();
            if (pregunta !== '') {
                socket.emit('enviar_pregunta', { sala: salaActual, pregunta });
                inputPregunta.value = '';
            }
        });

        socket.on('sala_creada', (sala) => {
            salaActual = sala;
            document.getElementById('codigo').innerText = `Código de sala: ${sala}`;
            document.querySelector('.homepage').style.display = 'none';
            document.getElementById('sala').style.display = 'block';
            document.querySelector('.chat-column').style.display = 'block'; // Mostrar la columna de chat
            document.getElementById('formulario').style.display = 'block';
            document.getElementById('preguntas').style.display = 'block';
            document.querySelector('.central-column').innerText = 'Aquí se importará el PPT';
            console.log('Sala creada:', salaActual);
        });

        socket.on('sala_unida', (sala) => {
            salaActual = sala;
            document.getElementById('codigo').innerText = `Código de sala: ${sala}`;
            document.querySelector('.homepage').style.display = 'none';
            document.getElementById('sala').style.display = 'block';
            document.querySelector('.chat-column').style.display = 'block'; // Mostrar la columna de chat
            document.getElementById('formulario').style.display = 'block';
            document.getElementById('preguntas').style.display = 'block';
            document.querySelector('.central-column').innerText = 'Aquí se importará el PPT';
            console.log('Sala unida:', salaActual);
        });

        socket.on('redireccionar_sala', (sala) => {
            window.location.href = `/${sala}`;
        });

        socket.on('nueva_pregunta', (data) => {
            const nuevaPregunta = document.createElement('div');
            nuevaPregunta.textContent = data.pregunta;
            nuevaPregunta.style.color = data.color;
            listaPreguntas.appendChild(nuevaPregunta);
            console.log('Nueva pregunta recibida:', data);
        });

        socket.on('error', (error) => {
            console.error('Error:', error);
            alert(error);
        });

        // Footer dinámico para mostrar si estás logeado o no
        const footer = document.getElementById('footer');
        const isLoggedIn = false; // Cambiar a true si está logeado
        if (isLoggedIn) {
            footer.innerHTML = '<p>Estás logeado.</p>';
        } else {
            footer.innerHTML = '<p>No estás logeado. <a href="http://localhost:3000/login.html">Iniciar sesión</a></p>';
        }
    </script>
</body>
</html>
